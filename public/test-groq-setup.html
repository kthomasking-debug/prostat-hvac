<!DOCTYPE html>
<html>
<head>
    <title>Set Groq API Key for Testing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 { color: #667eea; margin-top: 0; }
        .success { 
            background: #10b981; 
            color: white; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 20px 0;
            display: none;
        }
        .info {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #5568d3;
        }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #667eea;
        }
        .model-list {
            background: #f9fafb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .model-item {
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .model-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”‘ Groq API Key Setup & Testing</h1>
        
        <div class="info">
            <strong>ðŸ“‹ Instructions:</strong>
            <ol>
                <li>Click "Set API Key in localStorage" below</li>
                <li>Click "Open Cost Forecaster" to test Ask Joule</li>
                <li>Try asking: "What can I save?" or "Set winter to 68"</li>
            </ol>
        </div>

        <div class="success" id="successMsg">
            âœ… API key has been set in localStorage!
        </div>

        <button onclick="setApiKey()">Set API Key in localStorage</button>
        <button onclick="checkModels()">Check Available Models</button>
        <button onclick="openCostForecaster()">Open Cost Forecaster</button>
        <button onclick="clearStorage()">Clear localStorage</button>

        <div class="info" style="margin-top: 20px;">
            <strong>API Key:</strong> <code>gsk_ZmW7ote...kD</code> (free tier)<br>
            <strong>Default Model:</strong> <code>llama-3.3-70b-versatile</code>
        </div>

        <div id="modelList" class="model-list" style="display: none;">
            <h3 style="margin-top: 0;">Available Models:</h3>
            <div id="models"></div>
        </div>

        <div id="storageInfo" class="info" style="display: none; margin-top: 20px;">
            <h3 style="margin-top: 0;">Current localStorage:</h3>
            <pre id="storageContent" style="overflow-x: auto;"></pre>
        </div>
    </div>

    <script>
        const API_KEY = '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';

        function setApiKey() {
            try {
                // Set in both possible key names
                localStorage.setItem('groqApiKey', API_KEY);
                localStorage.setItem('groq_api_key', API_KEY);
                
                // Also set up test location and onboarding state
                localStorage.setItem('hasCompletedOnboarding', 'true');
                localStorage.setItem('engineering_suite_terms_accepted', 'true');
                localStorage.setItem('engineering_suite_terms_accepted_version', '1.0');
                localStorage.setItem('userLocation', JSON.stringify({
                    city: 'Atlanta',
                    state: 'GA',
                    latitude: 33.7490,
                    longitude: -84.3880,
                    elevation: 1050
                }));
                
                document.getElementById('successMsg').style.display = 'block';
                showStorage();
                
                console.log('âœ… Groq API key set successfully!');
                console.log('You can now use Ask Joule with AI features.');
            } catch (error) {
                alert('Error setting API key: ' + error.message);
            }
        }

        async function checkModels() {
            try {
                const response = await fetch('https://api.groq.com/openai/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const models = data?.data || [];
                
                const modelList = document.getElementById('models');
                modelList.innerHTML = models.map((model, idx) => `
                    <div class="model-item">
                        <strong>${idx + 1}. ${model.id}</strong>
                        ${model.owned_by ? `<br><small style="color: #6b7280;">Owner: ${model.owned_by}</small>` : ''}
                    </div>
                `).join('');
                
                document.getElementById('modelList').style.display = 'block';
                console.log(`Found ${models.length} available models`);
            } catch (error) {
                alert('Error fetching models: ' + error.message);
            }
        }

        function openCostForecaster() {
            window.open('http://localhost:5173/cost-forecaster', '_blank');
        }

        function clearStorage() {
            if (confirm('Clear all localStorage data?')) {
                localStorage.clear();
                document.getElementById('successMsg').style.display = 'none';
                document.getElementById('storageInfo').style.display = 'none';
                console.log('localStorage cleared');
            }
        }

        function showStorage() {
            const storage = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                storage[key] = localStorage.getItem(key);
            }
            document.getElementById('storageContent').textContent = JSON.stringify(storage, null, 2);
            document.getElementById('storageInfo').style.display = 'block';
        }

        // Check on load if API key is already set
        window.onload = function() {
            const existingKey = localStorage.getItem('groqApiKey') || localStorage.getItem('groq_api_key');
            if (existingKey) {
                document.getElementById('successMsg').style.display = 'block';
                showStorage();
            }
        };
    </script>
</body>
</html>
